function _classPrivateFieldLooseBase(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var id=0;function _classPrivateFieldLooseKey(e){return"__private_"+id+++"_"+e}this.HypertextEditor=function(){"use strict";const e={getSelection(){const t=window.getSelection();return Object.assign(t,e)},getRange(){return 0===this.rangeCount?null:this.getRangeAt(0)},isRangeInEl(e){const t=this.getRange();return!!t&&e.contains(t.commonAncestorContainer)},saveRange(){this.rangeCount>0&&(this.cacheRange=this.getRangeAt(0))},restoreRange(){const e=this.getSelection();e.removeAllRanges(),this.cacheRange&&(e.addRange(this.cacheRange),this.cacheRange=null)},queryState(e){const t=this.getSelection();if("bold"===e)return document.queryCommandState("bold");if("color"===e)return document.queryCommandValue("foreColor");if("text"===e)return t.toString();if("fontSize"===e){let e=t.getRange().startContainer;const n=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;return window.getComputedStyle(n).fontSize}}},t=e.getSelection;function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var o="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,r=o||i||Function("return this")(),a=function(){return r.Date.now()},s=/\s/;var l=/^\s+/;function c(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&s.test(e.charAt(t)););return t}(e)+1).replace(l,""):e}var u=r.Symbol,d=Object.prototype,f=d.hasOwnProperty,h=d.toString,v=u?u.toStringTag:void 0;var g=Object.prototype.toString;var m="[object Null]",y="[object Undefined]",p=u?u.toStringTag:void 0;function b(e){return null==e?void 0===e?y:m:p&&p in Object(e)?function(e){var t=f.call(e,v),n=e[v];try{e[v]=void 0;var o=!0}catch(e){}var i=h.call(e);return o&&(t?e[v]=n:delete e[v]),i}(e):function(e){return g.call(e)}(e)}var S="[object Symbol]";var x=NaN,E=/^[-+]0x[0-9a-f]+$/i,C=/^0b[01]+$/i,L=/^0o[0-7]+$/i,O=parseInt;function R(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&b(e)==S}(e))return x;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=c(e);var o=C.test(e);return o||L.test(e)?O(e.slice(2),o?2:8):E.test(e)?x:+e}var j=Math.max,T=Math.min;function _(e,t,o){var i,r,s,l,c,u,d=0,f=!1,h=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=i,o=r;return i=r=void 0,d=t,l=e.apply(o,n)}function m(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-d>=s}function y(){var e=a();if(m(e))return p(e);c=setTimeout(y,function(e){var n=t-(e-u);return h?T(n,s-(e-d)):n}(e))}function p(e){return c=void 0,v&&i?g(e):(i=r=void 0,l)}function b(){var e=a(),n=m(e);if(i=arguments,r=this,u=e,n){if(void 0===c)return function(e){return d=e,c=setTimeout(y,t),f?g(e):l}(u);if(h)return clearTimeout(c),c=setTimeout(y,t),g(u)}return void 0===c&&(c=setTimeout(y,t)),l}return t=R(t)||0,n(o)&&(f=!!o.leading,s=(h="maxWait"in o)?j(R(o.maxWait)||0,t):s,v="trailing"in o?!!o.trailing:v),b.cancel=function(){void 0!==c&&clearTimeout(c),d=0,i=u=r=c=void 0},b.flush=function(){return void 0===c?l:p(a())},b}var w=_classPrivateFieldLooseKey("composing"),P=_classPrivateFieldLooseKey("codeSelectionChange"),N=_classPrivateFieldLooseKey("execCommand");class F{constructor(e){void 0===e&&(e={}),Object.defineProperty(this,N,{value:q}),this.el=void 0,this.color="",this.bold=!1,this.fontSize="",Object.defineProperty(this,w,{writable:!0,value:!1}),this.getSelection=t,Object.defineProperty(this,P,{writable:!0,value:!1});const n="string"==typeof(e=Object.assign({},F.defaultOptions,e)).el?document.querySelector(e.el):e.el;n.style.outline="none",n.style.overflowY="auto",n.contentEditable=!0,n.innerHTML=e.content,this.maxlength=e.maxlength,"input"===e.mode&&n.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()})),n.addEventListener("keypress",(e=>{this.text.length>=this.maxlength&&e.preventDefault()})),n.addEventListener("compositionstart",(()=>_classPrivateFieldLooseBase(this,w)[w]=!0)),n.addEventListener("compositionend",(()=>{const e=this.text.length-this.maxlength;if(e>0){const n=document.createRange(),o=t(),i=o.anchorNode,r=o.anchorOffset,a=i.textContent;n.selectNodeContents(i),o.removeAllRanges(),o.addRange(n),o.extend(i,r),document.execCommand("delete",!1),document.execCommand("insertText",!1,a.substring(0,r-e))}_classPrivateFieldLooseBase(this,w)[w]=!1})),n.addEventListener("paste",(e=>{let t=(e.clipboardData||window.clipboardData).getData("text");const o=n.textContent.length+t.length-this.maxlength;o>0&&(t=t.slice(0,-o)),document.execCommand("insertText",!1,t),e.preventDefault()})),this.el=n}get content(){return this.el.innerHTML}get text(){return this.el.textContent}on(e,n){let o;return"change"===e&&(o=_(n.bind(this),300),this.el.addEventListener("input",o)),"selectionchange"===e&&(o=_((()=>{if(_classPrivateFieldLooseBase(this,P)[P])return void(_classPrivateFieldLooseBase(this,P)[P]=!1);if(document.activeElement!==this.el)return n.call(this,null);const e=t(),o={bold:e.queryState("bold"),color:e.queryState("color"),fontSize:e.queryState("fontSize"),text:e.queryState("text")};n.call(this,o)}),300),document.addEventListener("selectionchange",o)),o}off(e,t){"change"===e&&this.el.removeEventListener("input",t),"selectionchange"===e&&document.removeEventListener("selectionchange",t)}formatText(e,n){"color"===e&&(this.color=n),"bold"===e&&(this.bold=!this.bold);const o=t();o.selectAllChildren(this.el);let i=e;_classPrivateFieldLooseBase(this,N)[N](i,n),o.removeAllRanges(),this.el.blur()}format(e,n){_classPrivateFieldLooseBase(this,P)[P]=!0;const o=t();if(!o.getRange()||!o.isRangeInEl(this.el))return;let i=e;"color"===e&&(i="foreColor"),_classPrivateFieldLooseBase(this,N)[N](i,n)}}function q(e,n){const o=t();if(document.execCommand("styleWithCSS",!0),"color"===e&&(e="foreColor"),document.execCommand(e,!1,n),"fontSize"===e){o.anchorNode.parentNode.style.fontSize=n}if(o.saveRange(),o.selectAllChildren(this.el),"foreColor"===e){const e=o.queryState("color");this.color!==e&&(this.color=e)}if("bold"===e){const e=o.queryState("bold");this.bold!==e&&(this.bold=e)}if("fontSize"===e){const e=function(e,t,n){let o=!0;return function i(r){if(r.nodeType===Node.ELEMENT_NODE){if(r!==e&&r.style[t])return void(o=r.style[t]===n);for(const e of r.childNodes)if(i(e),!1===o)return}else{for(;r!==e;)if((r=r.parentElement).style[t])return void(o=r.style[t]===n);o=!1}}(e),o}(this.el,"fontSize",n);e&&(this.fontSize=n)}o.restoreRange()}return F.defaultOptions={el:"#editor",content:"",maxlength:1/0,mode:"textarea"},F}();
