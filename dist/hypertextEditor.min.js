this.HypertextEditor=function(){"use strict";const e={getSelection(){const t=window.getSelection();return Object.assign(t,e)},getRange(){return 0===this.rangeCount?null:this.getRangeAt(0)},isRangeInEl(e){const t=this.getRange();return!!t&&e.contains(t.commonAncestorContainer)},saveRange(){this.rangeCount>0&&(this.cacheRange=this.getRangeAt(0))},restoreRange(){const e=this.getSelection();e.removeAllRanges(),this.cacheRange&&(e.addRange(this.cacheRange),this.cacheRange=null)},queryState(e){const t=this.getSelection();if("bold"===e)return document.queryCommandState("bold");if("color"===e)return document.queryCommandValue("foreColor");if("text"===e)return t.toString();if("fontSize"===e){let e=t.getRange().startContainer;const n=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;return window.getComputedStyle(n).fontSize}}},t=e.getSelection;function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var o="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,r=o||i||Function("return this")(),l=function(){return r.Date.now()},c=/\s/;var a=/^\s+/;function s(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&c.test(e.charAt(t)););return t}(e)+1).replace(a,""):e}var u=r.Symbol,d=Object.prototype,f=d.hasOwnProperty,h=d.toString,g=u?u.toStringTag:void 0;var m=Object.prototype.toString;var v="[object Null]",p="[object Undefined]",y=u?u.toStringTag:void 0;function b(e){return null==e?void 0===e?p:v:y&&y in Object(e)?function(e){var t=f.call(e,g),n=e[g];try{e[g]=void 0;var o=!0}catch(e){}var i=h.call(e);return o&&(t?e[g]=n:delete e[g]),i}(e):function(e){return m.call(e)}(e)}var S="[object Symbol]";var x=NaN,C=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,R=/^0o[0-7]+$/i,T=parseInt;function O(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&b(e)==S}(e))return x;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=s(e);var o=E.test(e);return o||R.test(e)?T(e.slice(2),o?2:8):C.test(e)?x:+e}var j=Math.max,N=Math.min;function L(e,t,o){var i,r,c,a,s,u,d=0,f=!1,h=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=i,o=r;return i=r=void 0,d=t,a=e.apply(o,n)}function v(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-d>=c}function p(){var e=l();if(v(e))return y(e);s=setTimeout(p,function(e){var n=t-(e-u);return h?N(n,c-(e-d)):n}(e))}function y(e){return s=void 0,g&&i?m(e):(i=r=void 0,a)}function b(){var e=l(),n=v(e);if(i=arguments,r=this,u=e,n){if(void 0===s)return function(e){return d=e,s=setTimeout(p,t),f?m(e):a}(u);if(h)return clearTimeout(s),s=setTimeout(p,t),m(u)}return void 0===s&&(s=setTimeout(p,t)),a}return t=O(t)||0,n(o)&&(f=!!o.leading,c=(h="maxWait"in o)?j(O(o.maxWait)||0,t):c,g="trailing"in o?!!o.trailing:g),b.cancel=function(){void 0!==s&&clearTimeout(s),d=0,i=u=r=s=void 0},b.flush=function(){return void 0===s?a:y(l())},b}class w{el;color="";bold=!1;fontSize="";#e=!1;getSelection=t;static defaultOptions={el:"#editor",content:"",maxlength:1/0,mode:"textarea"};constructor(e={}){const n="string"==typeof(e=Object.assign({},w.defaultOptions,e)).el?document.querySelector(e.el):e.el;n.style.outline="none",n.style.overflowY="auto",n.contentEditable=!0,n.innerHTML=e.content,this.maxlength=e.maxlength,"input"===e.mode&&n.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()})),n.addEventListener("keypress",(e=>{this.text.length>=this.maxlength&&e.preventDefault()})),n.addEventListener("compositionstart",(()=>this.#e=!0)),n.addEventListener("compositionend",(()=>{const e=this.text.length-this.maxlength;if(e>0){const n=document.createRange(),o=t(),i=o.anchorNode,r=o.anchorOffset,l=i.textContent;n.selectNodeContents(i),o.removeAllRanges(),o.addRange(n),o.extend(i,r),document.execCommand("delete",!1),document.execCommand("insertText",!1,l.substring(0,r-e))}this.#e=!1})),n.addEventListener("paste",(e=>{let t=(e.clipboardData||window.clipboardData).getData("text");const o=n.textContent.length+t.length-this.maxlength;o>0&&(t=t.slice(0,-o)),document.execCommand("insertText",!1,t),e.preventDefault()})),this.el=n}get content(){return this.el.innerHTML}get text(){return this.el.textContent}on(e,n){let o;return"change"===e&&(o=L(n.bind(this),300),this.el.addEventListener("input",o)),"selectionchange"===e&&(o=L((()=>{if(this.#t)return void(this.#t=!1);if(document.activeElement!==this.el)return n.call(this,null);const e=t(),o={bold:e.queryState("bold"),color:e.queryState("color"),fontSize:e.queryState("fontSize"),text:e.queryState("text")};n.call(this,o)}),300),document.addEventListener("selectionchange",o)),o}off(e,t){"change"===e&&this.el.removeEventListener("input",t),"selectionchange"===e&&document.removeEventListener("selectionchange",t)}#t=!1;formatText(e,n){"color"===e&&(this.color=n),"bold"===e&&(this.bold=!this.bold);const o=t();o.selectAllChildren(this.el);let i=e;this.#n(i,n),o.removeAllRanges(),this.el.blur()}format(e,n){this.#t=!0;const o=t();if(!o.getRange()||!o.isRangeInEl(this.el))return;let i=e;"color"===e&&(i="foreColor"),this.#n(i,n)}#n(e,n){const o=t();if(document.execCommand("styleWithCSS",!0),"color"===e&&(e="foreColor"),document.execCommand(e,!1,n),"fontSize"===e){o.anchorNode.parentNode.style.fontSize=n}if(o.saveRange(),o.selectAllChildren(this.el),"foreColor"===e){const e=o.queryState("color");this.color!==e&&(this.color=e)}if("bold"===e){const e=o.queryState("bold");this.bold!==e&&(this.bold=e)}if("fontSize"===e){const e=function(e,t,n){let o=!0;return function i(r){if(r.nodeType===Node.ELEMENT_NODE){if(r!==e&&r.style[t])return void(o=r.style[t]===n);for(const e of r.childNodes)if(i(e),!1===o)return}else{for(;r!==e;)if((r=r.parentElement).style[t])return void(o=r.style[t]===n);o=!1}}(e),o}(this.el,"fontSize",n);e&&(this.fontSize=n)}o.restoreRange()}}return w}();
